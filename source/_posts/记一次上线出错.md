---
title: 记一次上线出错的反思与总结
date: 2017-09-29 09:52:21
tags: [札记]
description: 昨天因为自己的失误，被部署组长给骂了一顿，觉得很受教;今早项目组长又让我反馈昨天出错的原因，于是有了这篇反思与总结的文章
---

一直没出现的问题，没想到昨天出现了，虽然觉得挺无语的，但是确实让我意识到自己的不足。
对于一个大项目的把握和掌控，自己存在了很多的不足与问题。
事情的起因呢，是自己让部署组长部署上线代码很多次，就惹他生气了，说我不测试清楚就乱上线上线代码，原话是“什么时候是最终的版本，你检测清楚，不要拿生产环境当做测试”。第二次呢，是因为自己无缘无故删除了一部分路由却没发现。第三次呢，是因为自己对于一些不经常修改的js文件，没有加上版本信息。第四次呢，是因为很奇怪，有个变量被修改了，自己都不知道什么时候被修改了，于是就出错了，唉。_(:зゝ∠)_
于是，今早jyx项目组长让我总结下昨天出错问题的原因。他问我修改项目内容，是整个项目替换，还是增量更新？上线之后会不会保留一个版本？放到生产上的代码都是用本地最新代码，通过构建工具生成的？像上个版本没问题，新版本上了之后却有问题，这种原因有哪些？起初，我有点不耐烦他的一连串问题，但是细细想下来，确实是我现在急需要思考的问题，果然`愤怒来源于自己的无知`这句话是对的。
我对于这些问题，没有很好的回答，我果然是对项目的掌控没有很好的经验。于是，也和前端小组反应了这个问题，虽然还是没有太好的解决办法，但是也让我对项目主管的问题更理解了。

#### 整个项目替换，还是增量替换？
- 目前用的框架是vue全家桶+webpack，怎么做到增量替换/更新?很难啊，要是你这次为了上线修改的内容不仅包含这次上线的内容，还包含下次上线的内容，而测试必然会着重测试这次上线的内容，下次上线的内容不会去测或者没认真去测，于是就出现我昨天出现的问题了，这就是直接原因。
由于webpack打包肯定是整个项目src的内容，所以目前想到的办法是：
一是让自己撤回下次上线的内容。这个在内容少的时候，可操作高，但是人都有惰性，可能这次会这么做，下次就不会这么做了。由于项目用的SVN，每次提交的时候注释就很重要了，最好在每次上线的版本提交一次。
二是记录打包的dist文件，然后只更新这次上线的js文件。这个办法over，因为webpack的manifest文件记录是的每个页面最新的js文件，要是下次上线的js文件不部署，就看不到这个页面了。
三是服务器打包部署。这个得后端配合，可操作性不高，虽然比较能解决我的问题。
四是svn分支写代码。也否决了

#### 上线之后会不会保留一个版本？
- 以前我都不会在每个版本提交svn信息来记录，以后得注意了

#### 放到生产上的代码都是用本地最新代码，通过构建工具生成的？
- 这是必然的吧。不知道项目组长考虑的是什么

#### 像上个版本没问题，新版本上了以后却有问题，这种原因有哪些？
- 一个是测试没测试到我这次修改的部分。像有很多产品，每个产品有不同的定制页面，有些公用的提取出来。比如jquery.validate.js，验证表单的，昨天一次部署就是不知道怎么修改了一个变量，导致一些产品的验证出错了，但是这次上线的内容不包含这些产品，于是就出现问题了，这个还是真是难以解决啊。要是这些公用的js出错了，但只影响一些产品，那就糟糕了。而且有时候上次上线的内容还未完善，这次修改完善的内容测试没去测试就糟糕了，所以还是要自己提醒下才行。

#### 总结
- 以后上线的代码已经部署了之后，不要把上线当做测试环境，如果要重新上线代码，不要直接部署上线代码，要让测试再仔细测试，自己再测试测试，不然有意想不到的bug发生又要再次上线，就会被怼的，记住了。
- 还有每次修改了的内容一定要用svn记录好，这次上线和上线的内容到底修改了什么，一定记得去测试测试
- 虽然没有太多的办法解决昨天发生的问题，但是意识到这个问题也是很受教的。

